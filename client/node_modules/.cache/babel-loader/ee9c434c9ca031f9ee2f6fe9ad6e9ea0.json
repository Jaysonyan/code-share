{"ast":null,"code":"const TextDocument = import(\"./textdocument\");\nconst Character = import(\"./character\");\nconst MAX_INDEX = 10;\n\nclass CRDT {\n  constructor() {\n    this.document = new TextDocument();\n  }\n\n  sendInsert(pos, char) {\n    let newIndex = this.getIndexFromPos(pos);\n    let newChar = new Character(char, newIndex);\n    this.document.insertChar(newChar); // Emit char\n  }\n\n  sendDelete(pos) {\n    let deletedChar = this.document.getChar(pos.row, pos.column);\n    this.document.deleteChar(deletedChar); // Emit char\n  }\n\n  receiveInsert(character) {\n    this.document.insertChar(character);\n  }\n\n  receiveDelete(character) {\n    this.document.deleteChar(character);\n  }\n\n  getIndexFromPos(pos) {\n    let row = pos.row,\n        column = pos.column;\n    let leftIdx = this.document.getLeftChar(pos).relativeIndex;\n    let rightIdx = this.document.getRightChar(pos).relativeIndex;\n    let returnIdx = [];\n    let i = 0;\n\n    while (leftIdx[i] && rightIdx[i] && leftIdx[i] === rightIdx[i]) {\n      returnIdx.push(leftIdx[i]);\n      i++;\n    }\n\n    if (!leftIdx[i]) {\n      if (rightIdx[i] === 1) {\n        returnIdx.concat([0, MAX_INDEX / 2]);\n      } else {\n        returnIdx.push(rightIdx[i] / 2);\n      }\n    } else if (!rightIdx[i]) {\n      returnIdx.push(rightIdx + 1);\n    } else {\n      if (rightIdx[i] - leftIdx[i] === 1) {\n        returnIdx.concat([leftIdx[i], MAX_INDEX / 2]);\n      } else {\n        returnIdx.push((leftIdx[i] + rightIdx[i]) / 2);\n      }\n    }\n\n    return returnIdx;\n  }\n\n  toText() {\n    return this.document.getString();\n  }\n\n}\n\nexport default CRDT;","map":{"version":3,"sources":["/Users/Jayson/Desktop/code-share/client/src/components/crdt.js"],"names":["TextDocument","Character","MAX_INDEX","CRDT","constructor","document","sendInsert","pos","char","newIndex","getIndexFromPos","newChar","insertChar","sendDelete","deletedChar","getChar","row","column","deleteChar","receiveInsert","character","receiveDelete","leftIdx","getLeftChar","relativeIndex","rightIdx","getRightChar","returnIdx","i","push","concat","toText","getString"],"mappings":"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","sourcesContent":["const TextDocument = import(\"./textdocument\")\nconst Character = import(\"./character\")\nconst MAX_INDEX = 10\n\nclass CRDT {\n\n  constructor() {\n    this.document = new TextDocument()\n  }\n\n  sendInsert(pos, char) {\n    let newIndex = this.getIndexFromPos(pos)\n    let newChar = new Character(char, newIndex)\n    this.document.insertChar(newChar)\n    // Emit char\n  }\n\n  sendDelete(pos) {\n    let deletedChar = this.document.getChar(pos.row, pos.column)\n    this.document.deleteChar(deletedChar)\n    // Emit char\n  }\n\n  receiveInsert(character) {\n    this.document.insertChar(character)\n  }\n\n  receiveDelete(character) {\n    this.document.deleteChar(character)\n  }\n\n  getIndexFromPos(pos) {\n    let { row, column } = pos\n\n    let leftIdx = this.document.getLeftChar(pos).relativeIndex\n    let rightIdx = this.document.getRightChar(pos).relativeIndex\n    let returnIdx = []\n\n    let i = 0\n    while(leftIdx[i] && rightIdx[i] && leftIdx[i] === rightIdx[i]) {\n      returnIdx.push(leftIdx[i])\n      i++\n    }\n    if (!leftIdx[i]) {\n      if (rightIdx[i] === 1) {\n        returnIdx.concat([0, MAX_INDEX/2])\n      } else {\n        returnIdx.push(rightIdx[i]/2)\n      }\n    } else if (!rightIdx[i]) {\n      returnIdx.push(rightIdx+1)\n    } else {\n      if (rightIdx[i] - leftIdx[i] === 1) {\n        returnIdx.concat([leftIdx[i], MAX_INDEX/2])\n      } else {\n        returnIdx.push((leftIdx[i] + rightIdx[i])/2)\n      }\n    }\n    return returnIdx\n  }\n\n  toText() {\n    return this.document.getString()\n  }\n}\n\nexport default CRDT\n"]},"metadata":{},"sourceType":"module"}
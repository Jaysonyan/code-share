{"ast":null,"code":"const Document = import(\"./document\");\nconst MAX_INDEX = 10;\n\nclass CRDT {\n  constructor() {\n    this.document = Document();\n  }\n\n  sendInsert(pos, char) {\n    let newIndex = this.getIndexFromPos(pos);\n    let newChar = {\n      char: char,\n      relativeIndex: newIndex\n    };\n    this.document.insertChar(newChar); // Emit char\n  }\n\n  sendDelete(pos) {\n    let deletedChar = this.document.getChar(pos.row, pos.column);\n    this.document.deleteChar(deletedChar); // Emit char\n  }\n\n  receiveInsert(character) {\n    this.document.insertChar(character);\n  }\n\n  receiveDelete(character) {\n    this.document.deleteChar(character);\n  }\n\n  getIndexFromPos(pos) {\n    let row = pos.row,\n        column = pos.column;\n    let leftIdx = this.document.getLeftChar(pos).relativeIndex;\n    let rightIdx = this.document.getRightChar(pos).relativeIndex;\n    let returnIdx = [];\n    let i = 0;\n\n    while (leftIdx[i] && rightIdx[i] && leftIdx[i] === rightIdx[i]) {\n      returnIdx.push(leftIdx[i]);\n      i++;\n    }\n\n    if (!leftIdx[i]) {\n      if (rightIdx[i] === 1) {\n        returnIdx.concat([0, MAX_INDEX / 2]);\n      } else {\n        returnIdx.push(rightIdx[i] / 2);\n      }\n    } else if (!rightIdx[i]) {\n      returnIdx.push(rightIdx + 1);\n    } else {\n      if (rightIdx[i] - leftIdx[i] === 1) {\n        returnIdx.concat([leftIdx[i], MAX_INDEX / 2]);\n      } else {\n        returnIdx.push((leftIdx[i] + rightIdx[i]) / 2);\n      }\n    }\n\n    return returnIdx;\n  }\n\n  toText() {\n    return this.document.getString();\n  }\n\n}\n\nexport default CRDT;","map":{"version":3,"sources":["/Users/Jayson/Desktop/code-share/client/src/components/crdt.js"],"names":["Document","MAX_INDEX","CRDT","constructor","document","sendInsert","pos","char","newIndex","getIndexFromPos","newChar","relativeIndex","insertChar","sendDelete","deletedChar","getChar","row","column","deleteChar","receiveInsert","character","receiveDelete","leftIdx","getLeftChar","rightIdx","getRightChar","returnIdx","i","push","concat","toText","getString"],"mappings":"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","sourcesContent":["const Document = import(\"./document\")\nconst MAX_INDEX = 10\n\nclass CRDT {\n  constructor() {\n    this.document = Document()\n  }\n\n  sendInsert(pos, char) {\n    let newIndex = this.getIndexFromPos(pos)\n    let newChar = { char: char, relativeIndex: newIndex }\n    this.document.insertChar(newChar)\n    // Emit char\n  }\n\n  sendDelete(pos) {\n    let deletedChar = this.document.getChar(pos.row, pos.column)\n    this.document.deleteChar(deletedChar)\n    // Emit char\n  }\n\n  receiveInsert(character) {\n    this.document.insertChar(character)\n  }\n\n  receiveDelete(character) {\n    this.document.deleteChar(character)\n  }\n\n  getIndexFromPos(pos) {\n    let { row, column } = pos\n\n    let leftIdx = this.document.getLeftChar(pos).relativeIndex\n    let rightIdx = this.document.getRightChar(pos).relativeIndex\n    let returnIdx = []\n\n    let i = 0\n    while(leftIdx[i] && rightIdx[i] && leftIdx[i] === rightIdx[i]) {\n      returnIdx.push(leftIdx[i])\n      i++\n    }\n    if (!leftIdx[i]) {\n      if (rightIdx[i] === 1) {\n        returnIdx.concat([0, MAX_INDEX/2])\n      } else {\n        returnIdx.push(rightIdx[i]/2)\n      }\n    } else if (!rightIdx[i]) {\n      returnIdx.push(rightIdx+1)\n    } else {\n      if (rightIdx[i] - leftIdx[i] === 1) {\n        returnIdx.concat([leftIdx[i], MAX_INDEX/2])\n      } else {\n        returnIdx.push((leftIdx[i] + rightIdx[i])/2)\n      }\n    }\n    return returnIdx\n  }\n\n  toText() {\n    return this.document.getString()\n  }\n}\n\nexport default CRDT\n"]},"metadata":{},"sourceType":"module"}